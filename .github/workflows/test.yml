name: Test

on: push

jobs:

  prepare:
    runs-on: ubuntu-latest

    if: "! contains(github.event.head_commit.message, '[ci skip]')"

    steps:
      - run: echo "${{ github.event.head_commit.message }}"

  build:
    runs-on: ubuntu-latest

    needs: prepare

    steps:
    - uses: actions/checkout@v2

    - uses: actions/setup-elixir@v1.2.0
      with:
        otp-version: 22.x
        elixir-version: 1.10.x

    - uses: actions/cache@v1
      with:
        path: deps
        key: ${{ runner.os }}-hex-${{ hashFiles('**/mix.lock') }}

    - uses: actions/cache@v1
      with:
        path: _build/test
        key: ${{ runner.os }}-build-${{ hashFiles('**/mix.lock') }}

    - run: mix deps.get

    - run: mix credo

    - run: mix test
